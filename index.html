<!DOCTYPE html>
<html>
<head>
    <title>Dropdown Debugging</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        #filter-controls {
            margin: 10px;
        }
    </style>
</head>
<body>

    <h1>Exploring Soil Interpretation Possibilities</h1>

    <div id="filter-controls">
        <label for="drainage-class-select">Filter by Drainage Class:</label>
        <select id="drainage-class-select">
            <option value="all">Show All</option>
            <!-- Drainage class options will be populated by JavaScript -->
        </select>
    </div>

    <!--
    <div id="mapid"></div>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    -->

    <script>
        const textFileUrl = "https://raw.githubusercontent.com/agduck29/interps/main/data/tabular/comp.txt";

        async function populateDrainageDropdown() {
            try {
                // Fetch the text file
                const textFileResponse = await fetch(textFileUrl);
                const textFileData = await textFileResponse.text();

                console.log("Text file data:", textFileData); // Check if data is fetched

                // Parse the text file data (using pipe as delimiter)
                const rows = textFileData.trim().split('\n');
                const header = rows.split('|'); // Get header row

                console.log("Header row:", header); // Check the header row

                // Find the index of the "drainagecl" column
                const drainageClassIndex = header.indexOf("drainagecl");

                console.log("Drainage Class Index:", drainageClassIndex); // Check the index

                if (drainageClassIndex === -1) {
                    console.error("Error: Could not find 'drainagecl' column in the text file header.");
                    return;
                }

                // Collect unique drainage classes
                const uniqueDrainageClasses = new Set();
                for (let i = 1; i < rows.length; i++) {
                    const values = rows[i].split('|'); // Split values by pipe
                    const drainageClass = values[drainageClassIndex];

                    if (drainageClass) { // Check if drainageClass is not empty or undefined
                        uniqueDrainageClasses.add(drainageClass);
                    }
                }

                console.log("Unique Drainage Classes:", uniqueDrainageClasses); // Check the collected classes

                // Populate the drainage class dropdown
                const drainageSelect = document.getElementById('drainage-class-select');
                uniqueDrainageClasses.forEach(function(drainageClass) {
                    const option = document.createElement('option');
                    option.value = drainageClass;
                    option.textContent = drainageClass;
                    drainageSelect.appendChild(option);
                });

            } catch (error) {
                console.error("Error loading or parsing data:", error);
            }
        }

        // Call the function to populate the dropdown
        populateDrainageDropdown();

    </script>

</body>
</html>
